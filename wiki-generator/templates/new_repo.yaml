# Template: New Repository Wiki Entry
# Used when a brand new repository is detected on the GitHub account
# ===================================================================

name: "new_repository"
description: "Generates a complete wiki entry for a newly detected repository"

# Fields the AI must produce - maps directly to the Project interface in types.ts
required_fields:
  - name
  - slug
  - description
  - status
  - completion_percentage
  - tags
  - github_path
  - technologies
  - features
  - key_takeaways

optional_fields:
  - readme
  - adr
  - threatModel
  - cicdWorkflow

# System prompt for the draft AI agent
system_prompt: |
  You are a technical documentation specialist creating wiki entries for a
  software engineering portfolio. Your entries should be professional,
  technically accurate, and demonstrate deep understanding of the project.

  IMPORTANT RULES:
  - Be factual. Only reference technologies, patterns, and features that are
    evidenced in the repository's actual code, README, or configuration files.
  - Do NOT hallucinate features or technologies that don't exist in the repo.
  - Match the tone and depth of existing wiki entries (provided as examples).
  - Status must be one of: "Production Ready", "Advanced", "Substantial",
    "In Development", "Basic"
  - Completion percentage: 100=Production Ready, 70-85=Advanced,
    45-65=Substantial, 20-40=In Development, 10-20=Basic
  - Tags should be lowercase, hyphenated (e.g., "ci-cd", "machine-learning")
  - Technologies should be properly capitalized (e.g., "Docker", "Python")

# User prompt template - variables are filled by the scanner
user_prompt: |
  Create a wiki entry for this newly discovered repository.

  ## Repository Information
  - **Name:** {{repo_name}}
  - **Description:** {{repo_description}}
  - **Primary Language:** {{primary_language}}
  - **Languages Used:** {{languages}}
  - **Topics/Tags:** {{topics}}
  - **Default Branch:** {{default_branch}}
  - **Created:** {{created_at}}
  - **Last Updated:** {{updated_at}}
  - **Stars:** {{stars}}
  - **Has Wiki:** {{has_wiki}}
  - **Open Issues:** {{open_issues}}

  ## README Content
  ```
  {{readme_content}}
  ```

  ## Repository File Structure (top-level)
  ```
  {{file_tree}}
  ```

  ## Key Configuration Files Found
  {{config_files_content}}

  ## CI/CD Workflows Found
  {{cicd_content}}

  ## Existing Wiki Entries (for tone/style reference)
  Here are 2 example entries from the existing wiki to match style:
  ```json
  {{example_entries}}
  ```

  ---

  Generate a complete JSON object matching this TypeScript interface:
  ```typescript
  interface Project {
    id: number;           // Will be assigned, use 0
    name: string;
    slug: string;         // lowercase-hyphenated version of name
    description: string;  // 1-2 sentence technical summary
    status: "Production Ready" | "Advanced" | "Substantial" | "In Development" | "Basic";
    completion_percentage: number;
    tags: string[];       // 5-8 relevant lowercase tags
    github_path: string;  // "projects/<id>-<slug>"
    technologies: string[];  // 4-6 key technologies, properly capitalized
    features: string[];      // 4-6 key features, short descriptions
    key_takeaways: string[]; // 3 lessons learned, complete sentences
    readme?: string;         // Formatted markdown README for the wiki
    adr?: string;            // Architecture Decision Record (ADR-001 format)
    threatModel?: string;    // STRIDE threat model in markdown
  }
  ```

  Return ONLY the JSON object, no markdown fences or explanation.

# Validation rules applied after generation
validation:
  min_tags: 3
  max_tags: 10
  min_technologies: 2
  max_technologies: 8
  min_features: 3
  max_features: 8
  min_key_takeaways: 3
  max_key_takeaways: 5
  description_max_chars: 200
  required_threat_model_sections:
    - "Spoofing"
    - "Tampering"
    - "Repudiation"
    - "Information Disclosure"
    - "Denial of Service"
    - "Elevation of Privilege"
