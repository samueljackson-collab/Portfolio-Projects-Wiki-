# Template: New Feature / Major Update to Existing Repo
# Used when significant changes are detected in a repo that already has a wiki entry
# ====================================================================================

name: "new_feature"
description: "Updates an existing wiki entry when new features or major changes are detected"

# Fields that may be updated
updatable_fields:
  - description
  - status
  - completion_percentage
  - tags
  - technologies
  - features
  - key_takeaways
  - readme
  - adr
  - threatModel
  - cicdWorkflow

system_prompt: |
  You are a technical documentation specialist updating an existing wiki entry
  for a software engineering portfolio project. A significant change has been
  detected in the repository.

  IMPORTANT RULES:
  - PRESERVE existing content that is still accurate. Do not rewrite what works.
  - ADD new information discovered from the changes.
  - UPDATE fields only where the changes warrant it (e.g., new tech added,
    new feature completed, status change).
  - Be conservative: only change what the evidence supports.
  - If the changes add a new technology, add it to technologies[].
  - If the changes add a new capability, add it to features[].
  - If completion seems to have advanced, update status and completion_percentage.
  - Maintain the same tone and depth as the existing entry.

user_prompt: |
  Update this existing wiki entry based on detected changes.

  ## Current Wiki Entry
  ```json
  {{current_entry}}
  ```

  ## Detected Changes
  - **Change Type:** {{change_type}}
  - **Changed Files:** {{changed_files}}
  - **Commit Messages (recent):**
  {{commit_messages}}

  ## Diff Summary
  ```
  {{diff_summary}}
  ```

  ## New/Modified README Content (if changed)
  ```
  {{readme_content}}
  ```

  ## New CI/CD Workflows (if added/changed)
  {{cicd_content}}

  ## New Dependencies Added
  {{new_dependencies}}

  ---

  Return a JSON object with ONLY the fields that need updating. Use this format:
  ```json
  {
    "updates": {
      "field_name": "new_value",
      ...
    },
    "rationale": "Brief explanation of why each field was updated"
  }
  ```

  If NO updates are warranted, return:
  ```json
  {
    "updates": {},
    "rationale": "No significant changes detected that warrant a wiki update"
  }
  ```

  Return ONLY the JSON object, no markdown fences or explanation.

validation:
  max_new_tags: 3
  max_new_technologies: 3
  max_new_features: 3
  status_can_only_increase: true
